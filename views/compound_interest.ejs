<%- include('partials/header') %>

<div class="form-card">
    <h3 class="mb-5">Compound Interest Calculator</h3>
    <div class="row g-5">
        <!-- Left Column: Inputs (এই অংশটি ঠিক আছে) -->
        <div class="col-lg-6">
            <div class="slider-container"><div class="row align-items-center"><div class="col-md-5"><label for="principalInput" class="form-label mb-0">Principal Amount</label></div><div class="col-md-7"><div class="input-group"><span class="input-group-text">₹</span><input type="number" class="form-control" id="principalInput" min="1000" max="10000000" step="1000" placeholder="e.g., 1,00,000"></div></div></div><input type="range" min="1000" max="10000000" step="1000" class="form-range mt-2" id="principalSlider"></div>
            <div class="slider-container"><div class="row align-items-center"><div class="col-md-5"><label for="rateInput" class="form-label mb-0">Annual Interest Rate</label></div><div class="col-md-7"><div class="input-group"><input type="number" class="form-control" id="rateInput" min="1" max="30" step="0.1" placeholder="e.g., 8"><span class="input-group-text">%</span></div></div></div><input type="range" min="1" max="30" step="0.1" class="form-range mt-2" id="rateSlider"></div>
            <div class="slider-container"><div class="row align-items-center"><div class="col-md-5"><label for="timeInput" class="form-label mb-0">Time Period</label></div><div class="col-md-7"><div class="input-group"><input type="number" class="form-control" id="timeInput" min="1" max="40" step="1" placeholder="e.g., 10"><span class="input-group-text">Years</span></div></div></div><input type="range" min="1" max="40" step="1" class="form-range mt-2" id="timeSlider"></div>
            <div class="slider-container"><div class="row align-items-center"><div class="col-md-5"><label for="compoundingFrequency" class="form-label mb-0">Compounding</label></div><div class="col-md-7"><select class="form-select" id="compoundingFrequency"><option value="12">Monthly</option><option value="4">Quarterly</option><option value="2">Semi-Annually</option><option value="1" selected>Annually (Yearly)</option></select></div></div></div>
        </div>

        <!-- Right Column: Results (এই অংশটি ঠিক আছে) -->
        <div class="col-lg-6 d-flex flex-column">
            <div id="initialState" class="d-flex flex-grow-1 align-items-center justify-content-center h-100 text-center text-muted p-4" style="background-color: #f8f9fa; border-radius: 12px;"><h4>Enter your investment details to see the calculation.</h4></div>
            <div id="resultsState" class="flex-grow-1" style="display: none;"><div class="row h-100 align-items-center"><div class="col-md-7"><div class="emi-summary-card"><div class="summary-item"><div><span class="dot" style="background-color: #0d6efd;"></span><span class="label">Principal Amount</span></div><div class="value" id="totalPrincipal">₹0</div></div><div class="summary-item"><div><span class="dot" style="background-color: #198754;"></span><span class="label">Total Interest</span></div><div class="value" id="totalInterest">₹0</div></div><hr><div class="summary-item fw-bold"><div class="label">Total Maturity Value</div><div class="value fs-4" id="totalMaturityValue">₹0</div></div><div class="summary-item mt-3 p-2 bg-light rounded"><div class="label fw-bold text-primary">Effective Annual Rate</div><div class="value text-primary" id="effectiveAnnualRate">0%</div></div></div></div><div class="col-md-5 d-flex align-items-center justify-content-center"><canvas id="ciPieChart"></canvas></div></div></div>
        </div>
    </div>
    
    <!-- Yearly Breakdown -->
    <div id="yearlyBreakdownSection" class="mt-5" style="display: none;">
        <h4 class="text-center mb-4">Year-by-Year Growth</h4>
        <div class="table-responsive"><table class="table table-striped table-bordered text-center"><thead class="table-dark"><tr><th>Year</th><th>Interest Earned</th><th>End of Year Balance</th></tr></thead><tbody id="yearlyBreakdownBody"></tbody></table></div>
    </div>

    <!-- তথ্য সেকশন (চূড়ান্তভাবে পরিবর্তিত) -->
    <div class="info-accordion">
        <div class="accordion" id="calculatorInfoAccordion">
            <!-- Item 1: How to Use -->
            <div class="accordion-item"><h2 class="accordion-header" id="headingOne"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">How to Use This Calculator</button></h2><div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#calculatorInfoAccordion"><div class="accordion-body"><ol><li><strong>Enter Principal Amount:</strong> Use the slider or input box to set your initial investment.</li><li><strong>Set Annual Interest Rate:</strong> Input the expected annual rate of return.</li><li><strong>Define Time Period:</strong> Choose the duration of your investment in years.</li><li><strong>Select Compounding Frequency:</strong> Choose how often the interest is compounded (e.g., Annually, Monthly). Notice how more frequent compounding leads to higher returns!</li><li><strong>Analyze in Real-Time:</strong> The calculator will instantly show your future wealth, breaking it down into principal and interest.</li></ol></div></div></div>
            
            <!-- Item 2: Understanding the Metrics -->
            <div class="accordion-item"><h2 class="accordion-header" id="headingTwo"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Understanding the Metrics</button></h2><div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#calculatorInfoAccordion"><div class="accordion-body"><p><strong>Principal Amount:</strong> The initial amount of money you invest.</p><p><strong>Total Interest:</strong> The total profit earned on your investment. Unlike simple interest, this amount grows faster each year because you earn "interest on interest".</p><p><strong>Total Maturity Value:</strong> The final projected value of your investment, including both your principal and the total interest earned.</p><p><strong>Effective Annual Rate (EAR):</strong> This is your true annual rate of return when compounding occurs more than once a year. For example, a 12% annual rate compounded monthly has an EAR of 12.68%, which is higher than the stated rate.</p></div></div></div>
            
            <!-- ### নতুন: বিস্তারিত গাইড ### -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        The Ultimate Guide to Compound Interest
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#calculatorInfoAccordion">
                    <div class="accordion-body">
                        <p class="lead">Often called the "eighth wonder of the world," compound interest is the single most important concept for anyone looking to build long-term wealth. This guide explains why.</p>
                        <hr>
                        <h4>What is Compound Interest?</h4>
                        <p>Compound interest is the concept of earning <strong>interest on your interest</strong>. It is the result of reinvesting interest, rather than paying it out, so that interest in the next period is then earned on the principal sum plus previously accumulated interest.</p>
                        <blockquote class="blockquote bg-light p-3 rounded">"Compound interest is the eighth wonder of the world. He who understands it, earns it; he who doesn't, pays it." - <cite>Often attributed to Albert Einstein</cite></blockquote>

                        <h4>The Power of Compounding vs. <a href="/simple-interest">Simple Interest</a></h4>
                        <p>The difference is staggering over time. Let's take an example:</p>
                        <ul>
                            <li><strong>Investment:</strong> ₹1,00,000</li>
                            <li><strong>Interest Rate:</strong> 10% per year</li>
                            <li><strong>Time:</strong> 20 years</li>
                        </ul>
                        <p>With <strong>Simple Interest</strong>, you would earn ₹10,000 every year. After 20 years, your total value would be ₹1,00,000 (Principal) + ₹2,00,000 (Interest) = <strong>₹3,00,000</strong>.</p>
                        <p>With <strong>Compound Interest</strong> (compounded annually), your money grows exponentially. After 20 years, your total value would be approximately <strong>₹6,72,750</strong>! That's more than double the return of simple interest, all thanks to the "interest on interest" effect.</p>
                        
                        <h4>The Formula for Compound Interest</h4>
                        <p>The future value of an investment is calculated using the formula:</p>
                        <p class="text-center bg-light p-2 rounded"><code>A = P(1 + r/n)^(nt)</code></p>
                        <ul>
                            <li><strong>A</strong> = the future value of the investment/loan, including interest</li>
                            <li><strong>P</strong> = the principal investment amount (the initial deposit or loan amount)</li>
                            <li><strong>r</strong> = the annual interest rate (in decimal form)</li>
                            <li><strong>n</strong> = the number of times that interest is compounded per year</li>
                            <li><strong>t</strong> = the number of years the money is invested or borrowed for</li>
                        </ul>

                        <h4>Pro-Tip: The Rule of 72</h4>
                        <p>The "Rule of 72" is a quick, useful formula to estimate the number of years required to double your money at a given annual rate of return.</p>
                        <p class="text-center bg-light p-2 rounded"><strong>Years to Double ≈ 72 / Interest Rate</strong></p>
                        <p>For example, if your investment earns 12% per year, it will take approximately <strong>72 / 12 = 6 years</strong> for your money to double.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript (এই অংশটি ঠিক আছে) -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const principalSlider = document.getElementById('principalSlider'), rateSlider = document.getElementById('rateSlider'), timeSlider = document.getElementById('timeSlider');
        const principalInput = document.getElementById('principalInput'), rateInput = document.getElementById('rateInput'), timeInput = document.getElementById('timeInput');
        const compoundingFrequency = document.getElementById('compoundingFrequency');
        const initialState = document.getElementById('initialState'), resultsState = document.getElementById('resultsState'), yearlyBreakdownSection = document.getElementById('yearlyBreakdownSection');
        const totalPrincipal = document.getElementById('totalPrincipal'), totalInterest = document.getElementById('totalInterest'), totalMaturityValue = document.getElementById('totalMaturityValue');
        const effectiveAnnualRate = document.getElementById('effectiveAnnualRate');
        const yearlyBreakdownBody = document.getElementById('yearlyBreakdownBody'), pieChartCanvas = document.getElementById('ciPieChart');
        let ciPieChart;
        const formatCurrency = (num) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(num);
        function calculateAndDisplay() {
            const P = parseFloat(principalInput.value); const R_annual = parseFloat(rateInput.value) / 100; const T = parseFloat(timeInput.value); const n = parseFloat(compoundingFrequency.value);
            if (isNaN(P) || isNaN(R_annual) || isNaN(T) || isNaN(n) || P <= 0 || R_annual < 0 || T <= 0) { initialState.style.display = 'flex'; resultsState.style.display = 'none'; yearlyBreakdownSection.style.display = 'none'; if (ciPieChart) ciPieChart.destroy(); return; }
            initialState.style.display = 'none'; resultsState.style.display = 'block'; yearlyBreakdownSection.style.display = 'block';
            const totalAmount = P * Math.pow(1 + (R_annual / n), n * T); const totalInterestAmount = totalAmount - P;
            const ear = (Math.pow(1 + (R_annual / n), n) - 1) * 100;
            totalPrincipal.textContent = formatCurrency(P); totalInterest.textContent = formatCurrency(totalInterestAmount); totalMaturityValue.textContent = formatCurrency(totalAmount);
            effectiveAnnualRate.textContent = `${ear.toFixed(2)}%`;
            if (ciPieChart) ciPieChart.destroy();
            ciPieChart = new Chart(pieChartCanvas, { type: 'doughnut', data: { labels: ['Principal Amount', 'Total Interest'], datasets: [{ data: [P, totalInterestAmount], backgroundColor: ['#0d6efd', '#198754'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false } } } });
            yearlyBreakdownBody.innerHTML = ''; let previousYearBalance = P;
            for (let year = 1; year <= T; year++) {
                const endOfYearBalance = P * Math.pow(1 + (R_annual / n), n * year);
                const interestForYear = endOfYearBalance - previousYearBalance;
                const row = `<tr><td>${year}</td><td>${formatCurrency(interestForYear)}</td><td>${formatCurrency(endOfYearBalance)}</td></tr>`;
                yearlyBreakdownBody.innerHTML += row; previousYearBalance = endOfYearBalance;
            }
        }
        function syncAndCalculate(source, target) { target.value = source.value; calculateAndDisplay(); }
        principalSlider.addEventListener('input', () => syncAndCalculate(principalSlider, principalInput));
        principalInput.addEventListener('input', () => syncAndCalculate(principalInput, principalSlider));
        rateSlider.addEventListener('input', () => syncAndCalculate(rateSlider, rateInput));
        rateInput.addEventListener('input', () => syncAndCalculate(rateInput, rateSlider));
        timeSlider.addEventListener('input', () => syncAndCalculate(timeSlider, timeInput));
        timeInput.addEventListener('input', () => syncAndCalculate(timeInput, timeSlider));
        compoundingFrequency.addEventListener('change', calculateAndDisplay);
        calculateAndDisplay();
    });
</script>

<%- include('partials/footer') %>